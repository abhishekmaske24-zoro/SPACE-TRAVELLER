<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>SPACE TRAVELLER</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: black;
  font-family: Arial, sans-serif;
}

#loader {
  position: fixed;
  inset: 0;
  background: black;
  color: #00ffcc;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  z-index: 9999;
}

#ui {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

#score {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  color: #00ffcc;
  font-size: 24px;
  font-weight: bold;
}

.menu {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.85);
  color: white;
  pointer-events: auto;
}

button {
  padding: 12px 30px;
  font-size: 18px;
  font-weight: bold;
  border: none;
  background: #00ffcc;
  border-radius: 6px;
  cursor: pointer;
}

.hidden {
  display: none;
}
</style>
</head>

<body>

<div id="loader">ðŸš€ Loading Universe...</div>

<div id="ui">
  <div id="score" class="hidden">SCORE: 0</div>

  <div id="start" class="menu">
    <h1>STAR FIGHTER</h1>
    <p>Tap / Arrow Keys to Move</p>
    <button onclick="startGame()">START</button>
  </div>

  <div id="over" class="menu hidden">
    <h1 style="color:#ff0044">GAME OVER</h1>
    <p>Score: <span id="final">0</span></p>
    <button onclick="startGame()">RETRY</button>
  </div>
</div>

<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js";

let scene, camera, renderer;
let ship, stars;
let asteroids = [];
let score = 0;
let speed = 0.4;
let move = 0;
let running = false;

const loader = new THREE.TextureLoader();
const rocketTexture = loader.load("rocket.png");
const asteroidTexture = loader.load("asteroid.png");

/* INIT */
function init() {
  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(70, innerWidth / innerHeight, 0.1, 1000);
  camera.position.set(0, 3, 8);
  camera.lookAt(0, 0, 0);

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(devicePixelRatio);
  document.body.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff, 1.5));

  /* ROCKET */
  const shipMat = new THREE.MeshBasicMaterial({
    map: rocketTexture,
    transparent: true,
    side: THREE.DoubleSide
  });

  ship = new THREE.Mesh(new THREE.PlaneGeometry(1.5, 2.5), shipMat);
  ship.position.set(0, 0, 0);
  ship.rotation.x = -0.3;
  scene.add(ship);

  /* STARS */
  const starGeo = new THREE.BufferGeometry();
  const starArr = [];
  for (let i = 0; i < 1200; i++) {
    starArr.push(
      (Math.random() - 0.5) * 100,
      (Math.random() - 0.5) * 100,
      (Math.random() - 0.5) * 100
    );
  }
  starGeo.setAttribute("position", new THREE.Float32BufferAttribute(starArr, 3));
  stars = new THREE.Points(
    starGeo,
    new THREE.PointsMaterial({ color: 0xffffff, size: 0.12 })
  );
  scene.add(stars);

  /* CONTROLS */
  addEventListener("touchstart", e => {
    move = e.touches[0].clientX < innerWidth / 2 ? -0.18 : 0.18;
  });
  addEventListener("touchend", () => move = 0);

  addEventListener("keydown", e => {
    if (e.key === "ArrowLeft") move = -0.18;
    if (e.key === "ArrowRight") move = 0.18;
  });
  addEventListener("keyup", () => move = 0);

  document.getElementById("loader").style.display = "none";
  animate();
}

/* START GAME */
window.startGame = () => {
  score = 0;
  speed = 0.4;
  asteroids.forEach(a => scene.remove(a));
  asteroids = [];
  ship.position.set(0, 0, 0);

  document.getElementById("score").innerText = "SCORE: 0";
  document.getElementById("score").classList.remove("hidden");
  document.getElementById("start").classList.add("hidden");
  document.getElementById("over").classList.add("hidden");

  running = true;
};

/* ASTEROID */
function spawnAsteroid() {
  const mat = new THREE.MeshBasicMaterial({
    map: asteroidTexture,
    transparent: true,
    side: THREE.DoubleSide
  });

  const a = new THREE.Mesh(new THREE.PlaneGeometry(2, 2), mat);
  a.position.set((Math.random() - 0.5) * 10, 0, -40);
  a.rotation.z = Math.random() * Math.PI;
  scene.add(a);
  asteroids.push(a);
}

/* GAME OVER */
function gameOver() {
  running = false;
  document.getElementById("final").innerText = score;
  document.getElementById("over").classList.remove("hidden");
}

/* LOOP */
function animate() {
  requestAnimationFrame(animate);

  if (running) {
    ship.position.x += move;
    ship.position.x = Math.max(-5, Math.min(5, ship.position.x));
    ship.rotation.z = -move * 4;

    if (Math.random() < 0.035) spawnAsteroid();

    asteroids.forEach((a, i) => {
      a.position.z += speed;
      a.rotation.z += 0.04;

      if (ship.position.distanceTo(a.position) < 1.2) {
        gameOver();
      }

      if (a.position.z > 10) {
        scene.remove(a);
        asteroids.splice(i, 1);
        score++;
        speed += 0.01;
        document.getElementById("score").innerText = "SCORE: " + score;
      }
    });
  }

  stars.position.z += 0.15;
  if (stars.position.z > 50) stars.position.z = 0;

  renderer.render(scene, camera);
}

init();
</script>
</body>
</html>
